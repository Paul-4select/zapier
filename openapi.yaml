openapi: 3.0.0

info:
  title: Dialanta Zapier API
  version: "1.0.0"
  description: >
    API used by the Dialanta Zapier app: custom auth, create lead/contact,
    tags and webhooks.

servers:
  - url: https://{domain}/api/1.1
    variables:
      domain:
        default: app.dialanta.com
        description: Bubble app domain without protocol.

paths:
  /wf/auth_zapier:
    post:
      summary: Verify API key
      description: Used by the Zapier custom authentication test.
      security:
        - DialantaApiKeyHeader: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRequest'
      responses:
        "200":
          description: Authentication succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        "401":
          description: Invalid API key.

  /wf/zapier_create_lead:
    post:
      summary: Create lead
      description: Creates a lead in Dialanta from Zapier.
      security:
        - DialantaApiKeyHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLeadOrContactRequest'
      responses:
        "200":
          description: Lead created or error info.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateLeadOrContactResponse'

  /wf/zapier_create_contact:
    post:
      summary: Create contact
      description: Creates a contact in Dialanta from Zapier.
      security:
        - DialantaApiKeyHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLeadOrContactRequest'
      responses:
        "200":
          description: Contact created or error info.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateLeadOrContactResponse'

  /wf/zapier_get_tags:
    post:
      summary: Get company tags
      description: Used by the hidden Zapier trigger "Tags" for dynamic dropdown options.
      security:
        - DialantaApiKeyHeader: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetTagsRequest'
      responses:
        "200":
          description: List of tags.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tag'
        "401":
          description: Unauthorized.

  /wf/zapier_reg_webhook_create_lead:
    post:
      summary: Subscribe/unsubscribe lead webhooks
      description: Used by the trigger "When Lead Is Created".
      security:
        - DialantaApiKeyHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookSubscribeRequest'
      responses:
        "200":
          description: Webhook registration result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookSubscribeResponse'
        "401":
          description: Unauthorized.

  /wf/zapier_reg_webhook_added_contact:
    post:
      summary: Subscribe/unsubscribe contact webhooks
      description: Used by the trigger "When Contact Is Added".
      security:
        - DialantaApiKeyHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookSubscribeRequest'
      responses:
        "200":
          description: Webhook registration result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookSubscribeResponse'
        "401":
          description: Unauthorized.

  /wf/zapier_get_leads:
    post:
      summary: Get leads list
      description: Used as performList for both webhook triggers.
      security:
        - DialantaApiKeyHeader: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Array of leads.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LeadItem'
        "401":
          description: Unauthorized.

components:
  securitySchemes:
    DialantaApiKeyHeader:
      type: apiKey
      in: header
      name: X-DIALANTA-API-KEY

  schemas:
    AuthRequest:
      type: object
      description: Empty JSON body; API key is passed via X-DIALANTA-API-KEY header.
      additionalProperties: false

    AuthResponse:
      type: object
      required:
        - cid
        - name
      properties:
        cid:
          type: string
          description: Company ID.
        name:
          type: string
          description: Company name.

    CreateLeadOrContactRequest:
      type: object
      required:
        - first_name
        - last_name
        - email
        - phone
      properties:
        first_name:
          type: string
        last_name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
        source:
          type: string
          description: Lead or contact source.
          enum:
            - Manually Entered
            - Social Media
            - Website
        interest:
          type: string
        tags:
          type: array
          items:
            type: string
          description: Tag IDs or names.
        comments:
          type: string
        activate_ai:
          type: boolean
          description: Whether to activate AI processing.

    CreateLeadOrContactResponse:
      type: object
      properties:
        status:
          type: string
          description: "success" or "error".
        id:
          type: string
          description: Lead or contact ID.
        error:
          type: string
          description: Error message if any.

    GetTagsRequest:
      type: object
      description: Empty JSON body; API key is passed via X-DIALANTA-API-KEY header.
      additionalProperties: false

    Tag:
      type: object
      properties:
        id:
          type: string
        name:
          type: string

    WebhookSubscribeRequest:
      type: object
      required:
        - cid
        - hookUrl
        - action
      properties:
        cid:
          type: string
          description: Company ID.
        hookUrl:
          type: string
          format: uri
          description: Zapier webhook URL.
        action:
          type: string
          enum:
            - subscribe
            - unsubscribe

    WebhookSubscribeResponse:
      type: object
      properties:
        status:
          type: string
        error:
          type: string

    LeadItem:
      type: object
      properties:
        first_name:
          type: string
        last_name:
          type: string
        phone:
          type: string
        email:
          type: string
        source:
          type: string
        interest:
          type: string
        comment:
          type: string
        date:
          type: string
          format: date-time
        id:
          type: string
